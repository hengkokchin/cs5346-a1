<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Zoomable Sunburst Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .arc path {
            stroke: #fff;
        }
        .arc text {
            font-size: 12px;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <h2>Zoomable Sunburst Chart</h2>
    <svg width="800" height="600"></svg>
    <script>
        const width = 800;
        const height = 600;
        const radius = Math.min(width, height) / 2;

        const svg = d3.select("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${width / 2},${height / 2})`);

        const partition = d3.partition()
            .size([2 * Math.PI, radius]);

        const arc = d3.arc()
            .startAngle(d => d.x0)
            .endAngle(d => d.x1)
            .innerRadius(d => d.y0)
            .outerRadius(d => d.y1);

        d3.csv("./billboard_1990.csv").then(data => {
            let root = { name: "root", children: [] };
            let catMap = {};
            
            data.forEach(d => {
                if (!catMap[d.Genre]) {
                    catMap[d.Genre] = { name: d.Genre, children: [] };
                    root.children.push(catMap[d.Genre]);
                }
                catMap[d.Genre].children.push({ name: d.Subgenre, value: 1 });
            });

            root = d3.hierarchy(root)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            partition(root);

            const path = svg.selectAll(".arc")
                .data(root.descendants())
                .enter().append("path")
                .attr("class", "arc")
                .attr("d", arc)
                .style("fill", d => d.depth === 0 ? "#ddd" : d3.schemeCategory10[d.depth % 10])
                .on("click", clicked);

            function clicked(event, p) {
                svg.transition().duration(750)
                    .tween("scale", () => {
                        const xd = d3.interpolate(svg.property("_current"), [p.x0, p.x1]),
                              yd = d3.interpolate(svg.property("_current"), [p.y0, 1]);
                        return t => {
                            svg.property("_current", [xd(t), yd(t)]);
                            path.attr("d", arc);
                        };
                    });
            }
        });
    </script>
</body>
</html>
